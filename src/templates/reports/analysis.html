<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - {{ app_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
        }
        .metric-card {
            margin-bottom: 1rem;
        }
        .finding-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 0.25rem;
        }
        .recommendation-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #e9ecef;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <header class="mb-4">
            <h1 class="display-4">{{ title }}</h1>
            <p class="text-muted">生成时间：{{ generated_at }}</p>
        </header>

        <!-- 执行摘要 -->
        <section class="section">
            <h2>执行摘要</h2>
            
            <!-- 关键指标 -->
            <div class="mb-4">
                <h3>关键指标</h3>
                <div class="row">
                    {% for metric_name, metric_data in summary.key_metrics.items() %}
                    <div class="col-md-4">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title">{{ metric_name }}</h5>
                                <p class="card-text">
                                    平均值：{{ "%.2f"|format(metric_data.mean) }}<br>
                                    趋势：{{ metric_data.trend }}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- 主要发现 -->
            <div class="mb-4">
                <h3>主要发现</h3>
                {% for finding in summary.findings %}
                <div class="finding-item">
                    <h5>{{ finding.type|title }}</h5>
                    <p>{{ finding.description }}</p>
                </div>
                {% endfor %}
            </div>

            <!-- 建议 -->
            <div class="mb-4">
                <h3>建议</h3>
                {% for recommendation in summary.recommendations %}
                <div class="recommendation-item">
                    <p>{{ recommendation }}</p>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- 详细分析结果 -->
        <section class="section">
            <h2>详细分析结果</h2>

            <!-- 描述性统计 -->
            {% if analysis_results.descriptive %}
            <div class="mb-4">
                <h3>描述性统计</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>指标</th>
                                <th>均值</th>
                                <th>中位数</th>
                                <th>标准差</th>
                                <th>最小值</th>
                                <th>最大值</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for col, stats in analysis_results.descriptive.numeric_stats.items() %}
                            <tr>
                                <td>{{ col }}</td>
                                <td>{{ "%.2f"|format(stats.mean) }}</td>
                                <td>{{ "%.2f"|format(stats.median) }}</td>
                                <td>{{ "%.2f"|format(stats.std) }}</td>
                                <td>{{ "%.2f"|format(stats.min) }}</td>
                                <td>{{ "%.2f"|format(stats.max) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <!-- 相关性分析 -->
            {% if analysis_results.correlation %}
            <div class="mb-4">
                <h3>相关性分析</h3>
                {% if analysis_results.correlation.strong_correlations %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>变量1</th>
                                <th>变量2</th>
                                <th>相关系数</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for corr in analysis_results.correlation.strong_correlations %}
                            <tr>
                                <td>{{ corr.var1 }}</td>
                                <td>{{ corr.var2 }}</td>
                                <td>{{ "%.3f"|format(corr.correlation) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>未发现强相关性关系。</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- 趋势分析 -->
            {% if analysis_results.trend %}
            <div class="mb-4">
                <h3>趋势分析</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>指标</th>
                                <th>最新值</th>
                                <th>7日均值</th>
                                <th>30日均值</th>
                                <th>同比增长</th>
                                <th>趋势方向</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for col, stats in analysis_results.trend.trend_analysis.items() %}
                            <tr>
                                <td>{{ col }}</td>
                                <td>{{ "%.2f"|format(stats.latest_value) }}</td>
                                <td>{{ "%.2f"|format(stats.ma7) }}</td>
                                <td>{{ "%.2f"|format(stats.ma30) }}</td>
                                <td>{{ "%.2f"|format(stats.yoy_growth) }}</td>
                                <td>{{ stats.trend_direction }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <!-- 预测分析 -->
            {% if analysis_results.forecast %}
            <div class="mb-4">
                <h3>预测分析</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>指标</th>
                                <th>R²分数</th>
                                <th>RMSE</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for col, stats in analysis_results.forecast.forecast_analysis.items() %}
                            <tr>
                                <td>{{ col }}</td>
                                <td>{{ "%.3f"|format(stats.model_metrics.r2_score) }}</td>
                                <td>{{ "%.3f"|format(stats.model_metrics.rmse) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 